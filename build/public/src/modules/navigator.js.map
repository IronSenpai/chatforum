{"version":3,"sources":["public/src/modules/navigator.js"],"names":["define","pagination","components","navigator","index","count","navigatorUpdateTimeoutId","scrollActive","init","selector","toTop","toBottom","callback","calculateIndex","$","window","off","delayedUpdate","on","e","stopPropagation","setTimeout","focus","scrollUp","scrollDown","which","input","this","utils","isNumber","val","parseInt","url","generateUrl","trigger","ajaxify","go","setCount","update","pathname","location","replace","config","relative_path","parts","split","value","updateTextAndProgressBar","show","toggle","disable","flag","path","removeRelativePath","slice","startsWith","toggleClass","clearTimeout","threshold","undefined","els","length","first","attr","scrollTop","windowHeight","height","documentHeight","document","middleOfViewport","previousDistance","Number","MAX_VALUE","each","distanceToMiddle","Math","abs","offset","top","atTop","nearBottom","last","data","template","topic","anchorEl","get","anchorRect","getBoundingClientRect","translateHtml","width","animate","scrollToIndex","scrollBottom","scrollToPost","highlight","duration","console","log","inTopic","inCategory","scrollToPostIndex","scrollToTopicIndex","usePagination","scrollMethod","topicPostSort","postcount","categoryTopicSort","topic_count","page","max","ceil","postsPerPage","currentPage","loadPage","postIndex","scrollTo","scrollToElement","topicIndex","postHeight","viewportHeight","navbarHeight","done","animateScroll","scrollToRect","highlightPost","addClass","removeClass"],"mappings":"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","file":"public/src/modules/navigator.js","sourcesContent":["'use strict';\r\n\r\ndefine('navigator', ['forum/pagination', 'components'], function (pagination, components) {\r\n\tvar navigator = {};\r\n\tvar index = 1;\r\n\tvar count = 0;\r\n\tvar navigatorUpdateTimeoutId = 0;\r\n\r\n\tnavigator.scrollActive = false;\r\n\r\n\tnavigator.init = function (selector, count, toTop, toBottom, callback, calculateIndex) {\r\n\t\tindex = 1;\r\n\t\tnavigator.selector = selector;\r\n\t\tnavigator.callback = callback;\r\n\t\ttoTop = toTop || function () {};\r\n\t\ttoBottom = toBottom || function () {};\r\n\r\n\t\t$(window).off('scroll', navigator.delayedUpdate).on('scroll', navigator.delayedUpdate);\r\n\r\n\t\t$('.pagination-block .dropdown-menu').off('click').on('click', function (e) {\r\n\t\t\te.stopPropagation();\r\n\t\t});\r\n\r\n\t\t$('.pagination-block').off('shown.bs.dropdown', '.dropdown').on('shown.bs.dropdown', '.dropdown', function () {\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\t$('.pagination-block input').focus();\r\n\t\t\t}, 100);\r\n\t\t});\r\n\r\n\t\t$('.pagination-block .pageup').off('click').on('click', navigator.scrollUp);\r\n\t\t$('.pagination-block .pagedown').off('click').on('click', navigator.scrollDown);\r\n\t\t$('.pagination-block .pagetop').off('click').on('click', toTop);\r\n\t\t$('.pagination-block .pagebottom').off('click').on('click', toBottom);\r\n\r\n\t\t$('.pagination-block input').on('keydown', function (e) {\r\n\t\t\tif (e.which === 13) {\r\n\t\t\t\tvar input = $(this);\r\n\t\t\t\tif (!utils.isNumber(input.val())) {\r\n\t\t\t\t\tinput.val('');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar index = parseInt(input.val(), 10);\r\n\t\t\t\tif (typeof calculateIndex === 'function') {\r\n\t\t\t\t\tindex = calculateIndex(index, count);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar url = generateUrl(index);\r\n\t\t\t\tinput.val('');\r\n\t\t\t\t$('.pagination-block .dropdown-toggle').trigger('click');\r\n\t\t\t\tajaxify.go(url);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tnavigator.setCount(count);\r\n\t\tnavigator.update(0);\r\n\t};\r\n\r\n\tfunction generateUrl(index) {\r\n\t\tvar pathname = window.location.pathname.replace(config.relative_path, '');\r\n\t\tvar parts = pathname.split('/');\r\n\t\treturn parts[1] + '/' + parts[2] + '/' + parts[3] + (index ? '/' + index : '');\r\n\t}\r\n\r\n\tnavigator.setCount = function (value) {\r\n\t\tcount = parseInt(value, 10);\r\n\t\tnavigator.updateTextAndProgressBar();\r\n\t};\r\n\r\n\tnavigator.show = function () {\r\n\t\ttoggle(true);\r\n\t};\r\n\r\n\tnavigator.disable = function () {\r\n\t\tcount = 0;\r\n\t\tindex = 1;\r\n\t\tnavigator.callback = null;\r\n\t\tnavigator.selector = null;\r\n\t\t$(window).off('scroll', navigator.delayedUpdate);\r\n\r\n\t\ttoggle(false);\r\n\t};\r\n\r\n\tfunction toggle(flag) {\r\n\t\tvar path = ajaxify.removeRelativePath(window.location.pathname.slice(1));\r\n\t\tif (flag && (!path.startsWith('topic') && !path.startsWith('category'))) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t$('.pagination-block').toggleClass('ready', flag);\r\n\t}\r\n\r\n\tnavigator.delayedUpdate = function () {\r\n\t\tif (navigatorUpdateTimeoutId) {\r\n\t\t\tclearTimeout(navigatorUpdateTimeoutId);\r\n\t\t\tnavigatorUpdateTimeoutId = 0;\r\n\t\t}\r\n\t\tnavigatorUpdateTimeoutId = setTimeout(navigator.update, 100);\r\n\t};\r\n\r\n\tnavigator.update = function (threshold) {\r\n\t\t/*\r\n\t\t\tThe \"threshold\" is defined as the distance from the top of the page to\r\n\t\t\ta spot where a user is expecting to begin reading.\r\n\t\t*/\r\n\t\tthreshold = typeof threshold === 'number' ? threshold : undefined;\r\n\r\n\t\tvar els = $(navigator.selector);\r\n\t\tif (els.length) {\r\n\t\t\tindex = parseInt(els.first().attr('data-index'), 10) + 1;\r\n\t\t}\r\n\r\n\t\tvar scrollTop = $(window).scrollTop();\r\n\t\tvar windowHeight = $(window).height();\r\n\t\tvar documentHeight = $(document).height();\r\n\t\tvar middleOfViewport = scrollTop + (windowHeight / 2);\r\n\t\tvar previousDistance = Number.MAX_VALUE;\r\n\t\tels.each(function () {\r\n\t\t\tvar distanceToMiddle = Math.abs(middleOfViewport - $(this).offset().top);\r\n\r\n\t\t\tif (distanceToMiddle > previousDistance) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\tif (distanceToMiddle < previousDistance) {\r\n\t\t\t\tindex = parseInt($(this).attr('data-index'), 10) + 1;\r\n\t\t\t\tpreviousDistance = distanceToMiddle;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar atTop = scrollTop === 0 && parseInt(els.first().attr('data-index'), 10) === 0;\r\n\t\tvar nearBottom = scrollTop + windowHeight > documentHeight - 100 && parseInt(els.last().attr('data-index'), 10) === count - 1;\r\n\r\n\t\tif (atTop) {\r\n\t\t\tindex = 1;\r\n\t\t} else if (nearBottom) {\r\n\t\t\tindex = count;\r\n\t\t}\r\n\r\n\t\t// If a threshold is undefined, try to determine one based on new index\r\n\t\tif (threshold === undefined && ajaxify.data.template.topic === true) {\r\n\t\t\tif (atTop) {\r\n\t\t\t\tthreshold = 0;\r\n\t\t\t} else {\r\n\t\t\t\tvar anchorEl = components.get('post/anchor', index - 1);\r\n\t\t\t\tif (anchorEl.length) {\r\n\t\t\t\t\tvar anchorRect = anchorEl.get(0).getBoundingClientRect();\r\n\t\t\t\t\tthreshold = anchorRect.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (typeof navigator.callback === 'function') {\r\n\t\t\tnavigator.callback(index, count, threshold);\r\n\t\t}\r\n\r\n\t\tnavigator.updateTextAndProgressBar();\r\n\t\ttoggle(!!count);\r\n\t};\r\n\r\n\tnavigator.updateTextAndProgressBar = function () {\r\n\t\tif (!utils.isNumber(index)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tindex = index > count ? count : index;\r\n\r\n\t\t$('.pagination-block .pagination-text').translateHtml('[[global:pagination.out_of, ' + index + ', ' + count + ']]');\r\n\t\t$('.pagination-block .progress-bar').width((index / count * 100) + '%');\r\n\t};\r\n\r\n\tnavigator.scrollUp = function () {\r\n\t\t$('body,html').animate({\r\n\t\t\tscrollTop: $(window).scrollTop() - $(window).height(),\r\n\t\t});\r\n\t};\r\n\r\n\tnavigator.scrollDown = function () {\r\n\t\t$('body,html').animate({\r\n\t\t\tscrollTop: $(window).scrollTop() + $(window).height(),\r\n\t\t});\r\n\t};\r\n\r\n\tnavigator.scrollTop = function (index) {\r\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\r\n\t\t\tnavigator.scrollToIndex(index, true);\r\n\t\t} else {\r\n\t\t\tajaxify.go(generateUrl());\r\n\t\t}\r\n\t};\r\n\r\n\tnavigator.scrollBottom = function (index) {\r\n\t\tif (parseInt(index, 10) < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\r\n\t\t\tnavigator.scrollToIndex(index, true);\r\n\t\t} else {\r\n\t\t\tindex = parseInt(index, 10) + 1;\r\n\t\t\tajaxify.go(generateUrl(index));\r\n\t\t}\r\n\t};\r\n\r\n\tnavigator.scrollToPost = function (index, highlight, duration) {\r\n\t\tconsole.log('[navigator.scrollToPost] deprecated please use, navigator.scrollToIndex');\r\n\t\tnavigator.scrollToIndex(index, highlight, duration);\r\n\t};\r\n\r\n\tnavigator.scrollToIndex = function (index, highlight, duration) {\r\n\t\tvar inTopic = !!components.get('topic').length;\r\n\t\tvar inCategory = !!components.get('category').length;\r\n\r\n\t\tif (!utils.isNumber(index) || (!inTopic && !inCategory)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tduration = duration !== undefined ? duration : 400;\r\n\t\tnavigator.scrollActive = true;\r\n\r\n\t\t// if in topic and item already on page\r\n\t\tif (inTopic && components.get('post/anchor', index).length) {\r\n\t\t\treturn navigator.scrollToPostIndex(index, highlight, duration);\r\n\t\t}\r\n\r\n\t\t// if in category and item alreay on page\r\n\t\tif (inCategory && $('[component=\"category/topic\"][data-index=\"' + index + '\"]').length) {\r\n\t\t\treturn navigator.scrollToTopicIndex(index, highlight, duration);\r\n\t\t}\r\n\r\n\t\tif (!config.usePagination) {\r\n\t\t\tnavigator.scrollActive = false;\r\n\t\t\tindex = parseInt(index, 10) + 1;\r\n\t\t\tajaxify.go(generateUrl(index));\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar scrollMethod = inTopic ? navigator.scrollToPostIndex : navigator.scrollToTopicIndex;\r\n\t\tif (inTopic) {\r\n\t\t\tif (config.topicPostSort === 'most_votes' || config.topicPostSort === 'newest_to_oldest') {\r\n\t\t\t\tindex = ajaxify.data.postcount - index;\r\n\t\t\t}\r\n\t\t} else if (inCategory) {\r\n\t\t\tif (config.categoryTopicSort === 'most_posts' || config.categoryTopicSort === 'oldest_to_newest') {\r\n\t\t\t\tindex = ajaxify.data.ajaxify.data.topic_count - index;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar page = Math.max(1, Math.ceil((index + 1) / config.postsPerPage));\r\n\r\n\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\r\n\t\t\tpagination.loadPage(page, function () {\r\n\t\t\t\tscrollMethod(index, highlight, duration);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tscrollMethod(index, highlight, duration);\r\n\t\t}\r\n\t};\r\n\r\n\tnavigator.scrollToPostIndex = function (postIndex, highlight, duration) {\r\n\t\tvar scrollTo = components.get('post', 'index', postIndex);\r\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\r\n\t};\r\n\r\n\tnavigator.scrollToTopicIndex = function (topicIndex, highlight, duration) {\r\n\t\tvar scrollTo = $('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]');\r\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\r\n\t};\r\n\r\n\tnavigator.scrollToElement = function (scrollTo, highlight, duration) {\r\n\t\tif (!scrollTo.length) {\r\n\t\t\tnavigator.scrollActive = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar postHeight = scrollTo.height();\r\n\t\tvar viewportHeight = $(window).height();\r\n\t\tvar navbarHeight = components.get('navbar').height();\r\n\r\n\t\t// Temporarily disable navigator update on scroll\r\n\t\t$(window).off('scroll', navigator.update);\r\n\r\n\t\tduration = duration !== undefined ? duration : 400;\r\n\t\tnavigator.scrollActive = true;\r\n\t\tvar done = false;\r\n\r\n\t\tfunction animateScroll() {\r\n\t\t\tvar scrollTop = 0;\r\n\t\t\tif (postHeight < viewportHeight) {\r\n\t\t\t\tscrollTop = (scrollTo.offset().top - (viewportHeight / 2) + (postHeight / 2));\r\n\t\t\t} else {\r\n\t\t\t\tscrollTop = scrollTo.offset().top - navbarHeight;\r\n\t\t\t}\r\n\r\n\t\t\t$('html, body').animate({\r\n\t\t\t\tscrollTop: scrollTop + 'px',\r\n\t\t\t}, duration, function () {\r\n\t\t\t\tif (done) {\r\n\t\t\t\t\t// Re-enable onScroll behaviour\r\n\t\t\t\t\t$(window).on('scroll', navigator.update);\r\n\t\t\t\t\tvar scrollToRect = scrollTo.get(0).getBoundingClientRect();\r\n\t\t\t\t\tnavigator.update(scrollToRect.top);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdone = true;\r\n\r\n\t\t\t\tnavigator.scrollActive = false;\r\n\t\t\t\thighlightPost();\r\n\t\t\t\t$('body').scrollTop($('body').scrollTop() - 1);\r\n\t\t\t\t$('html').scrollTop($('html').scrollTop() - 1);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction highlightPost() {\r\n\t\t\tif (highlight) {\r\n\t\t\t\tscrollTo.addClass('highlight');\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tscrollTo.removeClass('highlight');\r\n\t\t\t\t}, 10000);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tanimateScroll();\r\n\t};\r\n\r\n\treturn navigator;\r\n});\r\n"]}