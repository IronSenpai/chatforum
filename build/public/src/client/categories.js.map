{"version":3,"sources":["public/src/client/categories.js"],"names":["define","components","translator","categories","$","window","on","ev","data","ajaxify","currentPage","url","socket","removeListener","onNewPost","init","app","enterRoom","tooltip","placement","posts","length","topic","renderNewPost","cid","post","category","get","numRecentReplies","attr","parseInt","recentPosts","find","parseAndTranslate","html","hide","appendTo","insertBefore","first","fadeIn","createUserTooltips","timeago","last","remove","trigger","callback","templates","parse","translate","translatedHTML","addClass"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,aAAc,cAAe,SAAUC,EAAYC,GAC9E,IAAIC,KAEJC,EAAEC,QAAQC,GAAG,uBAAwB,SAAUC,EAAIC,GAClD,GAAIC,QAAQC,cAAgBF,EAAKG,IAAK,CACrCC,OAAOC,eAAe,iBAAkBV,EAAWW,cAIrDX,EAAWY,KAAO,WACjBC,IAAIC,UAAU,cAEdL,OAAOC,eAAe,iBAAkBV,EAAWW,WACnDF,OAAON,GAAG,iBAAkBH,EAAWW,WAEvCV,EAAE,oBAAoBc,SACrBC,UAAW,YAIbhB,EAAWW,UAAY,SAAUN,GAChC,GAAIA,GAAQA,EAAKY,OAASZ,EAAKY,MAAMC,QAAUb,EAAKY,MAAM,GAAGE,MAAO,CACnEC,EAAcf,EAAKY,MAAM,GAAGE,MAAME,IAAKhB,EAAKY,MAAM,MAIpD,SAASG,EAAcC,EAAKC,GAC3B,IAAIC,EAAWzB,EAAW0B,IAAI,sBAAuB,MAAOH,GAC5D,IAAII,EAAmBF,EAASG,KAAK,yBACrC,IAAKD,IAAqBE,SAASF,EAAkB,IAAK,CACzD,OAGD,IAAIG,EAAcL,EAASM,KAAK,gCAEhCC,GAAmBR,GAAO,SAAUS,GACnCA,EAAKC,OACL,GAAIJ,EAAYV,SAAW,EAAG,CAC7Ba,EAAKE,SAASV,OACR,CACNQ,EAAKG,aAAaN,EAAYO,SAG/BJ,EAAKK,SAELvB,IAAIwB,qBACJN,EAAKF,KAAK,YAAYS,UAEtB,GAAIf,EAASM,KAAK,gCAAgCX,OAASS,SAASF,EAAkB,IAAK,CAC1FG,EAAYW,OAAOC,SAGpBvC,EAAEC,QAAQuC,QAAQ,uBAAyBxB,OAAQK,OAIrD,SAASQ,EAAkBb,EAAOyB,GACjCC,UAAUC,MAAM,aAAc,uBAAyB5C,YAAciB,MAAOA,IAAW,SAAUc,GAChGhC,EAAW8C,UAAUd,EAAM,SAAUe,GACpCA,EAAiB7C,EAAE6C,GACnBA,EAAejB,KAAK,0CAA0CkB,SAAS,kBAEvEL,EAASI,OAKZ,OAAO9C","file":"public/src/client/categories.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/categories', ['components', 'translator'], function (components, translator) {\r\n\tvar\tcategories = {};\r\n\r\n\t$(window).on('action:ajaxify.start', function (ev, data) {\r\n\t\tif (ajaxify.currentPage !== data.url) {\r\n\t\t\tsocket.removeListener('event:new_post', categories.onNewPost);\r\n\t\t}\r\n\t});\r\n\r\n\tcategories.init = function () {\r\n\t\tapp.enterRoom('categories');\r\n\r\n\t\tsocket.removeListener('event:new_post', categories.onNewPost);\r\n\t\tsocket.on('event:new_post', categories.onNewPost);\r\n\r\n\t\t$('.category-header').tooltip({\r\n\t\t\tplacement: 'bottom',\r\n\t\t});\r\n\t};\r\n\r\n\tcategories.onNewPost = function (data) {\r\n\t\tif (data && data.posts && data.posts.length && data.posts[0].topic) {\r\n\t\t\trenderNewPost(data.posts[0].topic.cid, data.posts[0]);\r\n\t\t}\r\n\t};\r\n\r\n\tfunction renderNewPost(cid, post) {\r\n\t\tvar category = components.get('categories/category', 'cid', cid);\r\n\t\tvar numRecentReplies = category.attr('data-numRecentReplies');\r\n\t\tif (!numRecentReplies || !parseInt(numRecentReplies, 10)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar recentPosts = category.find('[component=\"category/posts\"]');\r\n\r\n\t\tparseAndTranslate([post], function (html) {\r\n\t\t\thtml.hide();\r\n\t\t\tif (recentPosts.length === 0) {\r\n\t\t\t\thtml.appendTo(category);\r\n\t\t\t} else {\r\n\t\t\t\thtml.insertBefore(recentPosts.first());\r\n\t\t\t}\r\n\r\n\t\t\thtml.fadeIn();\r\n\r\n\t\t\tapp.createUserTooltips();\r\n\t\t\thtml.find('.timeago').timeago();\r\n\r\n\t\t\tif (category.find('[component=\"category/posts\"]').length > parseInt(numRecentReplies, 10)) {\r\n\t\t\t\trecentPosts.last().remove();\r\n\t\t\t}\r\n\r\n\t\t\t$(window).trigger('action:posts.loaded', { posts: [post] });\r\n\t\t});\r\n\t}\r\n\r\n\tfunction parseAndTranslate(posts, callback) {\r\n\t\ttemplates.parse('categories', '(categories.)?posts', { categories: { posts: posts } }, function (html) {\r\n\t\t\ttranslator.translate(html, function (translatedHTML) {\r\n\t\t\t\ttranslatedHTML = $(translatedHTML);\r\n\t\t\t\ttranslatedHTML.find('.post-content img:not(.not-responsive)').addClass('img-responsive');\r\n\r\n\t\t\t\tcallback(translatedHTML);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn categories;\r\n});\r\n"]}