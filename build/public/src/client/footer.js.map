{"version":3,"sources":["public/src/client/footer.js"],"names":["define","Notifications","Chat","components","translator","prepareDOM","updateUnreadTopicCount","url","count","$","config","relative_path","toggleClass","attr","updateUnreadChatCount","get","initUnreadTopics","unreadTopics","onNewPost","data","posts","length","post","parseInt","uid","app","user","topic","tid","increaseUnreadCount","markTopicsUnread","addClass","window","on","ev","match","socket","emit","err","alert","message","updateUnreadCounters","unreadChatCount","updateNotifCount","unreadNotificationCount","unreadTopicCount","unreadNewTopicCount","unreadWatchedTopicCount"],"mappings":"AAAA,aAGAA,OAAO,gBAAiB,gBAAiB,OAAQ,aAAc,cAAe,SAAUC,EAAeC,EAAMC,EAAYC,GACxHH,EAAcI,aACdH,EAAKG,aACLD,EAAWC,aAEX,SAASC,EAAuBC,EAAKC,GACpCC,EAAE,WAAaC,OAAOC,cAAgBJ,EAAM,QAC1CK,YAAY,eAAgBJ,EAAQ,GACpCK,KAAK,eAAgBL,EAAQ,GAAK,MAAQA,GAG7C,SAASM,EAAsBN,GAC9BL,EAAWY,IAAI,aACbH,YAAY,eAAgBJ,EAAQ,GACpCK,KAAK,eAAgBL,EAAQ,GAAK,MAAQA,GAG7C,SAASQ,IACR,IAAIC,KAEJ,SAASC,EAAUC,GAClB,GAAIA,GAAQA,EAAKC,OAASD,EAAKC,MAAMC,OAAQ,CAC5C,IAAIC,EAAOH,EAAKC,MAAM,GAEtB,GAAIG,SAASD,EAAKE,IAAK,MAAQD,SAASE,IAAIC,KAAKF,IAAK,MAAQP,EAAaK,EAAKK,MAAMC,KAAM,CAC3FC,IACAC,EAAiBR,EAAKK,MAAMC,KAC5BX,EAAaK,EAAKK,MAAMC,KAAO,OAKlC,SAASC,IACR,IAAIrB,EAAQe,SAASd,EAAE,mBAAmBI,KAAK,gBAAiB,IAAM,EACtEP,EAAuBE,GAGxB,SAASsB,EAAiBF,GACzBnB,EAAE,cAAgBmB,EAAM,MAAMG,SAAS,UAGxCtB,EAAEuB,QAAQC,GAAG,qBAAsB,SAAUC,EAAIf,GAChD,GAAIA,EAAKZ,IAAK,CACb,IAAIqB,EAAMT,EAAKZ,IAAI4B,MAAM,iBAEzB,GAAIP,GAAOA,EAAI,GAAI,QACXX,EAAaW,EAAI,QAK3BQ,OAAOH,GAAG,iBAAkBf,GAG7B,GAAIO,IAAIC,KAAKF,IAAK,CACjBY,OAAOC,KAAK,uBAAwB,SAAUC,EAAKnB,GAClD,GAAImB,EAAK,CACR,OAAOb,IAAIc,MAAMD,EAAIE,SAGtBC,EAAqBtB,GAErBL,EAAsBK,EAAKuB,iBAC3BzC,EAAc0C,iBAAiBxB,EAAKyB,2BAItC,SAASH,EAAqBtB,GAC7Bb,EAAuB,UAAWa,EAAK0B,kBACvCvC,EAAuB,cAAea,EAAK2B,qBAC3CxC,EAAuB,kBAAmBa,EAAK4B,yBAGhDX,OAAOH,GAAG,2BAA4BQ,GACtCL,OAAOH,GAAG,+BAAgCnB,GAE1CE","file":"public/src/client/footer.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/footer', ['notifications', 'chat', 'components', 'translator'], function (Notifications, Chat, components, translator) {\r\n\tNotifications.prepareDOM();\r\n\tChat.prepareDOM();\r\n\ttranslator.prepareDOM();\r\n\r\n\tfunction updateUnreadTopicCount(url, count) {\r\n\t\t$('a[href=\"' + config.relative_path + url + '\"] i')\r\n\t\t\t.toggleClass('unread-count', count > 0)\r\n\t\t\t.attr('data-content', count > 99 ? '99+' : count);\r\n\t}\r\n\r\n\tfunction updateUnreadChatCount(count) {\r\n\t\tcomponents.get('chat/icon')\r\n\t\t\t.toggleClass('unread-count', count > 0)\r\n\t\t\t.attr('data-content', count > 99 ? '99+' : count);\r\n\t}\r\n\r\n\tfunction initUnreadTopics() {\r\n\t\tvar unreadTopics = {};\r\n\r\n\t\tfunction onNewPost(data) {\r\n\t\t\tif (data && data.posts && data.posts.length) {\r\n\t\t\t\tvar post = data.posts[0];\r\n\r\n\t\t\t\tif (parseInt(post.uid, 10) !== parseInt(app.user.uid, 10) && !unreadTopics[post.topic.tid]) {\r\n\t\t\t\t\tincreaseUnreadCount();\r\n\t\t\t\t\tmarkTopicsUnread(post.topic.tid);\r\n\t\t\t\t\tunreadTopics[post.topic.tid] = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction increaseUnreadCount() {\r\n\t\t\tvar count = parseInt($('#unread-count i').attr('data-content'), 10) + 1;\r\n\t\t\tupdateUnreadTopicCount(count);\r\n\t\t}\r\n\r\n\t\tfunction markTopicsUnread(tid) {\r\n\t\t\t$('[data-tid=\"' + tid + '\"]').addClass('unread');\r\n\t\t}\r\n\r\n\t\t$(window).on('action:ajaxify.end', function (ev, data) {\r\n\t\t\tif (data.url) {\r\n\t\t\t\tvar tid = data.url.match(/^topic\\/(\\d+)/);\r\n\r\n\t\t\t\tif (tid && tid[1]) {\r\n\t\t\t\t\tdelete unreadTopics[tid[1]];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsocket.on('event:new_post', onNewPost);\r\n\t}\r\n\r\n\tif (app.user.uid) {\r\n\t\tsocket.emit('user.getUnreadCounts', function (err, data) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alert(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tupdateUnreadCounters(data);\r\n\r\n\t\t\tupdateUnreadChatCount(data.unreadChatCount);\r\n\t\t\tNotifications.updateNotifCount(data.unreadNotificationCount);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction updateUnreadCounters(data) {\r\n\t\tupdateUnreadTopicCount('/unread', data.unreadTopicCount);\r\n\t\tupdateUnreadTopicCount('/unread/new', data.unreadNewTopicCount);\r\n\t\tupdateUnreadTopicCount('/unread/watched', data.unreadWatchedTopicCount);\r\n\t}\r\n\r\n\tsocket.on('event:unread.updateCount', updateUnreadCounters);\r\n\tsocket.on('event:unread.updateChatCount', updateUnreadChatCount);\r\n\r\n\tinitUnreadTopics();\r\n});\r\n"]}