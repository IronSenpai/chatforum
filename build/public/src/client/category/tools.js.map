{"version":3,"sources":["public/src/client/category/tools.js"],"names":["define","move","topicSelect","components","translator","CategoryTools","init","cid","updateDropdownOptions","handlePinnedTopicSort","get","on","categoryCommand","getSelectedTids","tids","length","socket","emit","onCommandComplete","err","app","alertError","message","alertSuccess","forEach","tid","$","addClass","ajaxify","refresh","removeListeners","setDeleteState","onTopicPurged","setLockedState","setPinnedState","onTopicMoved","command","translate","msg","bootbox","confirm","onDeletePurgeComplete","removeListener","closeDropDown","find","trigger","unselectAll","isAnyDeleted","isAny","isTopicDeleted","areAllDeleted","areAll","isAnyPinned","isTopicPinned","isAnyLocked","isTopicLocked","toggleClass","method","i","getTopicEl","hasClass","data","topic","isDeleted","isPinned","isLocked","remove","privileges","isAdminOrMod","loadJQueryUI","sortable","items","update","pinnedTopics","each","index","element","push","attr","order"],"mappings":"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","file":"public/src/client/category/tools.js","sourcesContent":["\r\n'use strict';\r\n\r\n\r\ndefine('forum/category/tools', [\r\n\t'forum/topic/move',\r\n\t'topicSelect',\r\n\t'components',\r\n\t'translator',\r\n], function (move, topicSelect, components, translator) {\r\n\tvar CategoryTools = {};\r\n\r\n\tCategoryTools.init = function (cid) {\r\n\t\tCategoryTools.cid = cid;\r\n\r\n\t\ttopicSelect.init(updateDropdownOptions);\r\n\r\n\t\thandlePinnedTopicSort();\r\n\r\n\t\tcomponents.get('topic/delete').on('click', function () {\r\n\t\t\tcategoryCommand('delete', topicSelect.getSelectedTids());\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tcomponents.get('topic/restore').on('click', function () {\r\n\t\t\tcategoryCommand('restore', topicSelect.getSelectedTids());\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tcomponents.get('topic/purge').on('click', function () {\r\n\t\t\tcategoryCommand('purge', topicSelect.getSelectedTids());\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tcomponents.get('topic/lock').on('click', function () {\r\n\t\t\tvar tids = topicSelect.getSelectedTids();\r\n\t\t\tif (tids.length) {\r\n\t\t\t\tsocket.emit('topics.lock', { tids: tids, cid: CategoryTools.cid }, onCommandComplete);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tcomponents.get('topic/unlock').on('click', function () {\r\n\t\t\tvar tids = topicSelect.getSelectedTids();\r\n\t\t\tif (tids.length) {\r\n\t\t\t\tsocket.emit('topics.unlock', { tids: tids, cid: CategoryTools.cid }, onCommandComplete);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tcomponents.get('topic/pin').on('click', function () {\r\n\t\t\tvar tids = topicSelect.getSelectedTids();\r\n\t\t\tif (tids.length) {\r\n\t\t\t\tsocket.emit('topics.pin', { tids: tids, cid: CategoryTools.cid }, onCommandComplete);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tcomponents.get('topic/unpin').on('click', function () {\r\n\t\t\tvar tids = topicSelect.getSelectedTids();\r\n\t\t\tif (tids.length) {\r\n\t\t\t\tsocket.emit('topics.unpin', { tids: tids, cid: CategoryTools.cid }, onCommandComplete);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tcomponents.get('topic/mark-unread-for-all').on('click', function () {\r\n\t\t\tvar tids = topicSelect.getSelectedTids();\r\n\t\t\tif (tids.length) {\r\n\t\t\t\tsocket.emit('topics.markAsUnreadForAll', tids, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tapp.alertSuccess('[[topic:markAsUnreadForAll.success]]');\r\n\t\t\t\t\ttids.forEach(function (tid) {\r\n\t\t\t\t\t\t$('[component=\"category/topic\"][data-tid=\"' + tid + '\"]').addClass('unread');\r\n\t\t\t\t\t});\r\n\t\t\t\t\tonCommandComplete();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tcomponents.get('topic/move').on('click', function () {\r\n\t\t\tvar tids = topicSelect.getSelectedTids();\r\n\r\n\t\t\tif (tids.length) {\r\n\t\t\t\tmove.init(tids, cid, onCommandComplete);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tcomponents.get('topic/move-all').on('click', function () {\r\n\t\t\tmove.init(null, cid, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tajaxify.refresh();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tCategoryTools.removeListeners();\r\n\t\tsocket.on('event:topic_deleted', setDeleteState);\r\n\t\tsocket.on('event:topic_restored', setDeleteState);\r\n\t\tsocket.on('event:topic_purged', onTopicPurged);\r\n\t\tsocket.on('event:topic_locked', setLockedState);\r\n\t\tsocket.on('event:topic_unlocked', setLockedState);\r\n\t\tsocket.on('event:topic_pinned', setPinnedState);\r\n\t\tsocket.on('event:topic_unpinned', setPinnedState);\r\n\t\tsocket.on('event:topic_moved', onTopicMoved);\r\n\t};\r\n\r\n\tfunction categoryCommand(command, tids) {\r\n\t\tif (!tids.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttranslator.translate('[[topic:thread_tools.' + command + '_confirm]]', function (msg) {\r\n\t\t\tbootbox.confirm(msg, function (confirm) {\r\n\t\t\t\tif (!confirm) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsocket.emit('topics.' + command, { tids: tids, cid: CategoryTools.cid }, onDeletePurgeComplete);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tCategoryTools.removeListeners = function () {\r\n\t\tsocket.removeListener('event:topic_deleted', setDeleteState);\r\n\t\tsocket.removeListener('event:topic_restored', setDeleteState);\r\n\t\tsocket.removeListener('event:topic_purged', onTopicPurged);\r\n\t\tsocket.removeListener('event:topic_locked', setLockedState);\r\n\t\tsocket.removeListener('event:topic_unlocked', setLockedState);\r\n\t\tsocket.removeListener('event:topic_pinned', setPinnedState);\r\n\t\tsocket.removeListener('event:topic_unpinned', setPinnedState);\r\n\t\tsocket.removeListener('event:topic_moved', onTopicMoved);\r\n\t};\r\n\r\n\tfunction closeDropDown() {\r\n\t\t$('.thread-tools.open').find('.dropdown-toggle').trigger('click');\r\n\t}\r\n\r\n\tfunction onCommandComplete(err) {\r\n\t\tif (err) {\r\n\t\t\treturn app.alertError(err.message);\r\n\t\t}\r\n\t\tcloseDropDown();\r\n\t\ttopicSelect.unselectAll();\r\n\t}\r\n\r\n\tfunction onDeletePurgeComplete(err) {\r\n\t\tif (err) {\r\n\t\t\treturn app.alertError(err.message);\r\n\t\t}\r\n\t\tcloseDropDown();\r\n\t\tupdateDropdownOptions();\r\n\t}\r\n\r\n\tfunction updateDropdownOptions() {\r\n\t\tvar tids = topicSelect.getSelectedTids();\r\n\t\tvar isAnyDeleted = isAny(isTopicDeleted, tids);\r\n\t\tvar areAllDeleted = areAll(isTopicDeleted, tids);\r\n\t\tvar isAnyPinned = isAny(isTopicPinned, tids);\r\n\t\tvar isAnyLocked = isAny(isTopicLocked, tids);\r\n\r\n\t\tcomponents.get('topic/delete').toggleClass('hidden', isAnyDeleted);\r\n\t\tcomponents.get('topic/restore').toggleClass('hidden', !isAnyDeleted);\r\n\t\tcomponents.get('topic/purge').toggleClass('hidden', !areAllDeleted);\r\n\r\n\t\tcomponents.get('topic/lock').toggleClass('hidden', isAnyLocked);\r\n\t\tcomponents.get('topic/unlock').toggleClass('hidden', !isAnyLocked);\r\n\r\n\t\tcomponents.get('topic/pin').toggleClass('hidden', isAnyPinned);\r\n\t\tcomponents.get('topic/unpin').toggleClass('hidden', !isAnyPinned);\r\n\t}\r\n\r\n\tfunction isAny(method, tids) {\r\n\t\tfor (var i = 0; i < tids.length; i += 1) {\r\n\t\t\tif (method(tids[i])) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction areAll(method, tids) {\r\n\t\tfor (var i = 0; i < tids.length; i += 1) {\r\n\t\t\tif (!method(tids[i])) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction isTopicDeleted(tid) {\r\n\t\treturn getTopicEl(tid).hasClass('deleted');\r\n\t}\r\n\r\n\tfunction isTopicLocked(tid) {\r\n\t\treturn getTopicEl(tid).hasClass('locked');\r\n\t}\r\n\r\n\tfunction isTopicPinned(tid) {\r\n\t\treturn getTopicEl(tid).hasClass('pinned');\r\n\t}\r\n\r\n\tfunction getTopicEl(tid) {\r\n\t\treturn components.get('category/topic', 'tid', tid);\r\n\t}\r\n\r\n\tfunction setDeleteState(data) {\r\n\t\tvar topic = getTopicEl(data.tid);\r\n\t\ttopic.toggleClass('deleted', data.isDeleted);\r\n\t\ttopic.find('[component=\"topic/locked\"]').toggleClass('hide', !data.isDeleted);\r\n\t}\r\n\r\n\tfunction setPinnedState(data) {\r\n\t\tvar topic = getTopicEl(data.tid);\r\n\t\ttopic.toggleClass('pinned', data.isPinned);\r\n\t\ttopic.find('[component=\"topic/pinned\"]').toggleClass('hide', !data.isPinned);\r\n\t\tajaxify.refresh();\r\n\t}\r\n\r\n\tfunction setLockedState(data) {\r\n\t\tvar topic = getTopicEl(data.tid);\r\n\t\ttopic.toggleClass('locked', data.isLocked);\r\n\t\ttopic.find('[component=\"topic/locked\"]').toggleClass('hide', !data.isLocked);\r\n\t}\r\n\r\n\tfunction onTopicMoved(data) {\r\n\t\tgetTopicEl(data.tid).remove();\r\n\t}\r\n\r\n\tfunction onTopicPurged(data) {\r\n\t\tgetTopicEl(data.tid).remove();\r\n\t}\r\n\r\n\tfunction handlePinnedTopicSort() {\r\n\t\tif (!ajaxify.data.privileges.isAdminOrMod) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tapp.loadJQueryUI(function () {\r\n\t\t\t$('[component=\"category\"]').sortable({\r\n\t\t\t\titems: '[component=\"category/topic\"].pinned',\r\n\t\t\t\tupdate: function () {\r\n\t\t\t\t\tvar data = [];\r\n\r\n\t\t\t\t\tvar pinnedTopics = $('[component=\"category/topic\"].pinned');\r\n\t\t\t\t\tpinnedTopics.each(function (index, element) {\r\n\t\t\t\t\t\tdata.push({ tid: $(element).attr('data-tid'), order: pinnedTopics.length - index - 1 });\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tsocket.emit('topics.orderPinnedTopics', data, function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn CategoryTools;\r\n});\r\n"]}