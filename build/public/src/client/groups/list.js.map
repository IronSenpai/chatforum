{"version":3,"sources":["public/src/client/groups/list.js"],"names":["define","infinitescroll","Groups","init","loadMoreGroups","$","on","bootbox","prompt","name","length","socket","emit","err","ajaxify","go","utils","slugify","app","alertError","message","params","val","sort","search","direction","loadMore","after","attr","data","done","groups","templates","parse","html","append","nextStart","groupsEl","queryEl","sortEl","query","options","filterHidden","filter","group","empty"],"mappings":"AAAA,aAGAA,OAAO,qBAAsB,wBAAyB,SAAUC,GAC/D,IAAIC,KAEJA,EAAOC,KAAO,WACbF,EAAeE,KAAKD,EAAOE,gBAG3BC,EAAE,6BAA6BC,GAAG,QAAS,WAC1CC,QAAQC,OAAO,kCAAmC,SAAUC,GAC3D,GAAIA,GAAQA,EAAKC,OAAQ,CACxBC,OAAOC,KAAK,iBACXH,KAAMA,GACJ,SAAUI,GACZ,IAAKA,EAAK,CACTC,QAAQC,GAAG,UAAYC,MAAMC,QAAQR,QAC/B,CACNS,IAAIC,WAAWN,EAAIO,iBAMxB,IAAIC,EAASL,MAAMK,SACnBhB,EAAE,gBAAgBiB,IAAID,EAAOE,MAAQ,SAGrClB,EAAE,gBAAgBC,GAAG,QAASJ,EAAOsB,QACrCnB,EAAE,kBAAkBC,GAAG,QAASJ,EAAOsB,QACvCnB,EAAE,gBAAgBC,GAAG,SAAU,WAC9BQ,QAAQC,GAAG,eAAiBV,EAAE,gBAAgBiB,UAIhDpB,EAAOE,eAAiB,SAAUqB,GACjC,GAAIA,EAAY,EAAG,CAClB,OAGDxB,EAAeyB,SAAS,mBACvBH,KAAMlB,EAAE,gBAAgBiB,MACxBK,MAAOtB,EAAE,kCAAkCuB,KAAK,mBAC9C,SAAUC,EAAMC,GAClB,GAAID,GAAQA,EAAKE,OAAOrB,OAAQ,CAC/BsB,UAAUC,MAAM,wBACfF,OAAQF,EAAKE,QACX,SAAUG,GACZ7B,EAAE,gBAAgB8B,OAAOD,GACzBJ,UAEK,CACNA,IAGD,GAAID,GAAQA,EAAKO,UAAW,CAC3B/B,EAAE,kCAAkCuB,KAAK,iBAAkBC,EAAKO,eAKnElC,EAAOsB,OAAS,WACf,IAAIa,EAAWhC,EAAE,gBACjB,IAAIiC,EAAUjC,EAAE,gBAChB,IAAIkC,EAASlC,EAAE,gBAEfM,OAAOC,KAAK,iBACX4B,MAAOF,EAAQhB,MACfmB,SACClB,KAAMgB,EAAOjB,MACboB,aAAc,OAEb,SAAU7B,EAAKkB,GACjB,GAAIlB,EAAK,CACR,OAAOK,IAAIC,WAAWN,EAAIO,SAE3BW,EAASA,EAAOY,OAAO,SAAUC,GAChC,OAAOA,EAAMnC,OAAS,oBAAsBmC,EAAMnC,OAAS,WAE5DuB,UAAUC,MAAM,wBACfF,OAAQA,GACN,SAAUG,GACZG,EAASQ,QAAQV,OAAOD,OAG1B,OAAO,OAGR,OAAOhC","file":"public/src/client/groups/list.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/groups/list', ['forum/infinitescroll'], function (infinitescroll) {\r\n\tvar Groups = {};\r\n\r\n\tGroups.init = function () {\r\n\t\tinfinitescroll.init(Groups.loadMoreGroups);\r\n\r\n\t\t// Group creation\r\n\t\t$('button[data-action=\"new\"]').on('click', function () {\r\n\t\t\tbootbox.prompt('[[groups:new-group.group_name]]', function (name) {\r\n\t\t\t\tif (name && name.length) {\r\n\t\t\t\t\tsocket.emit('groups.create', {\r\n\t\t\t\t\t\tname: name,\r\n\t\t\t\t\t}, function (err) {\r\n\t\t\t\t\t\tif (!err) {\r\n\t\t\t\t\t\t\tajaxify.go('groups/' + utils.slugify(name));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tapp.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\tvar params = utils.params();\r\n\t\t$('#search-sort').val(params.sort || 'alpha');\r\n\r\n\t\t// Group searching\r\n\t\t$('#search-text').on('keyup', Groups.search);\r\n\t\t$('#search-button').on('click', Groups.search);\r\n\t\t$('#search-sort').on('change', function () {\r\n\t\t\tajaxify.go('groups?sort=' + $('#search-sort').val());\r\n\t\t});\r\n\t};\r\n\r\n\tGroups.loadMoreGroups = function (direction) {\r\n\t\tif (direction < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tinfinitescroll.loadMore('groups.loadMore', {\r\n\t\t\tsort: $('#search-sort').val(),\r\n\t\t\tafter: $('[component=\"groups/container\"]').attr('data-nextstart'),\r\n\t\t}, function (data, done) {\r\n\t\t\tif (data && data.groups.length) {\r\n\t\t\t\ttemplates.parse('partials/groups/list', {\r\n\t\t\t\t\tgroups: data.groups,\r\n\t\t\t\t}, function (html) {\r\n\t\t\t\t\t$('#groups-list').append(html);\r\n\t\t\t\t\tdone();\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdone();\r\n\t\t\t}\r\n\r\n\t\t\tif (data && data.nextStart) {\r\n\t\t\t\t$('[component=\"groups/container\"]').attr('data-nextstart', data.nextStart);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tGroups.search = function () {\r\n\t\tvar groupsEl = $('#groups-list');\r\n\t\tvar queryEl = $('#search-text');\r\n\t\tvar sortEl = $('#search-sort');\r\n\r\n\t\tsocket.emit('groups.search', {\r\n\t\t\tquery: queryEl.val(),\r\n\t\t\toptions: {\r\n\t\t\t\tsort: sortEl.val(),\r\n\t\t\t\tfilterHidden: true,\r\n\t\t\t},\r\n\t\t}, function (err, groups) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tgroups = groups.filter(function (group) {\r\n\t\t\t\treturn group.name !== 'registered-users' && group.name !== 'guests';\r\n\t\t\t});\r\n\t\t\ttemplates.parse('partials/groups/list', {\r\n\t\t\t\tgroups: groups,\r\n\t\t\t}, function (html) {\r\n\t\t\t\tgroupsEl.empty().append(html);\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn false;\r\n\t};\r\n\r\n\treturn Groups;\r\n});\r\n"]}