{"version":3,"sources":["public/src/client/account/edit/password.js"],"names":["define","header","translator","zxcvbn","AccountEditPassword","init","handlePasswordChange","currentPassword","$","password_notify","password_confirm_notify","password","password_confirm","passwordvalid","passwordsmatch","onPasswordChanged","passwordStrength","val","length","ajaxify","data","minimumPasswordLength","showError","utils","isPasswordValid","username","email","score","minimumPasswordStrength","showSuccess","onPasswordConfirmChanged","parent","removeClass","children","show","find","html","on","btn","this","app","user","isAdmin","addClass","socket","emit","newPassword","uid","theirid","err","alertError","message","window","location","href","config","relative_path","element","msg","translate"],"mappings":"AAAA,aAGAA,OAAO,+BAAgC,uBAAwB,aAAc,UAAW,SAAUC,EAAQC,EAAYC,GACrH,IAAIC,KAEJA,EAAoBC,KAAO,WAC1BJ,EAAOI,OAEPC,KAGD,SAASA,IACR,IAAIC,EAAkBC,EAAE,yBACxB,IAAIC,EAAkBD,EAAE,oBACxB,IAAIE,EAA0BF,EAAE,4BAChC,IAAIG,EAAWH,EAAE,qBACjB,IAAII,EAAmBJ,EAAE,0BACzB,IAAIK,EAAgB,MACpB,IAAIC,EAAiB,MAErB,SAASC,IACR,IAAIC,EAAmBb,EAAOQ,EAASM,OACvCJ,EAAgB,MAChB,GAAIF,EAASM,MAAMC,OAASC,QAAQC,KAAKC,sBAAuB,CAC/DC,EAAUb,EAAiB,8CACrB,IAAKc,MAAMC,gBAAgBb,EAASM,OAAQ,CAClDK,EAAUb,EAAiB,uCACrB,GAAIE,EAASM,QAAUE,QAAQC,KAAKK,SAAU,CACpDH,EAAUb,EAAiB,2CACrB,GAAIE,EAASM,QAAUE,QAAQC,KAAKM,MAAO,CACjDJ,EAAUb,EAAiB,wCACrB,GAAIO,EAAiBW,MAAQR,QAAQC,KAAKQ,wBAAyB,CACzEN,EAAUb,EAAiB,8BACrB,CACNoB,EAAYpB,GACZI,EAAgB,MAIlB,SAASiB,IACR,GAAInB,EAASM,QAAUL,EAAiBK,MAAO,CAC9CK,EAAUZ,EAAyB,wCACnCI,EAAiB,UACX,CACN,GAAIH,EAASM,MAAO,CACnBY,EAAYnB,OACN,CACNA,EAAwBqB,SAASC,YAAY,8BAC7CtB,EAAwBuB,WAAWC,OACnCxB,EAAwByB,KAAK,QAAQC,KAAK,IAG3CtB,EAAiB,MAInBH,EAAS0B,GAAG,OAAQtB,GACpBH,EAAiByB,GAAG,OAAQP,GAE5BtB,EAAE,sBAAsB6B,GAAG,QAAS,WACnCtB,IACAe,IAEA,IAAIQ,EAAM9B,EAAE+B,MACZ,GAAK1B,GAAiBC,GAAmB0B,IAAIC,KAAKC,QAAS,CAC1DJ,EAAIK,SAAS,YAAYR,KAAK,KAAKH,YAAY,QAC/CY,OAAOC,KAAK,uBACXtC,gBAAiBA,EAAgBU,MACjC6B,YAAanC,EAASM,MACtB8B,IAAK5B,QAAQC,KAAK4B,SAChB,SAAUC,GACZX,EAAIN,YAAY,YAAYG,KAAK,KAAKQ,SAAS,QAC/CpC,EAAgBU,IAAI,IACpBN,EAASM,IAAI,IACbL,EAAiBK,IAAI,IACrBH,EAAiB,MACjBD,EAAgB,MAEhB,GAAIoC,EAAK,CACRlC,IACAe,IACA,OAAOU,IAAIU,WAAWD,EAAIE,SAG3BC,OAAOC,SAASC,KAAOC,OAAOC,cAAgB,eAEzC,CACN,IAAK1C,EAAgB,CACpB0B,IAAIU,WAAW,wCAGhB,IAAKrC,EAAe,CACnB2B,IAAIU,WAAW,mCAGjB,OAAO,QAIT,SAAS5B,EAAUmC,EAASC,GAC3BxD,EAAWyD,UAAUD,EAAK,SAAUA,GACnCD,EAAQrB,KAAKsB,GAEbD,EAAQ1B,SACNC,YAAY,gBACZW,SAAS,iBAIb,SAASd,EAAY4B,GACpBA,EAAQrB,KAAK,IACbqB,EAAQ1B,SACNC,YAAY,eACZW,SAAS,gBAGZ,OAAOvC","file":"public/src/client/account/edit/password.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/account/edit/password', ['forum/account/header', 'translator', 'zxcvbn'], function (header, translator, zxcvbn) {\r\n\tvar AccountEditPassword = {};\r\n\r\n\tAccountEditPassword.init = function () {\r\n\t\theader.init();\r\n\r\n\t\thandlePasswordChange();\r\n\t};\r\n\r\n\tfunction handlePasswordChange() {\r\n\t\tvar currentPassword = $('#inputCurrentPassword');\r\n\t\tvar password_notify = $('#password-notify');\r\n\t\tvar password_confirm_notify = $('#password-confirm-notify');\r\n\t\tvar password = $('#inputNewPassword');\r\n\t\tvar password_confirm = $('#inputNewPasswordAgain');\r\n\t\tvar passwordvalid = false;\r\n\t\tvar passwordsmatch = false;\r\n\r\n\t\tfunction onPasswordChanged() {\r\n\t\t\tvar passwordStrength = zxcvbn(password.val());\r\n\t\t\tpasswordvalid = false;\r\n\t\t\tif (password.val().length < ajaxify.data.minimumPasswordLength) {\r\n\t\t\t\tshowError(password_notify, '[[user:change_password_error_length]]');\r\n\t\t\t} else if (!utils.isPasswordValid(password.val())) {\r\n\t\t\t\tshowError(password_notify, '[[user:change_password_error]]');\r\n\t\t\t} else if (password.val() === ajaxify.data.username) {\r\n\t\t\t\tshowError(password_notify, '[[user:password_same_as_username]]');\r\n\t\t\t} else if (password.val() === ajaxify.data.email) {\r\n\t\t\t\tshowError(password_notify, '[[user:password_same_as_email]]');\r\n\t\t\t} else if (passwordStrength.score < ajaxify.data.minimumPasswordStrength) {\r\n\t\t\t\tshowError(password_notify, '[[user:weak_password]]');\r\n\t\t\t} else {\r\n\t\t\t\tshowSuccess(password_notify);\r\n\t\t\t\tpasswordvalid = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onPasswordConfirmChanged() {\r\n\t\t\tif (password.val() !== password_confirm.val()) {\r\n\t\t\t\tshowError(password_confirm_notify, '[[user:change_password_error_match]]');\r\n\t\t\t\tpasswordsmatch = false;\r\n\t\t\t} else {\r\n\t\t\t\tif (password.val()) {\r\n\t\t\t\t\tshowSuccess(password_confirm_notify);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpassword_confirm_notify.parent().removeClass('alert-success alert-danger');\r\n\t\t\t\t\tpassword_confirm_notify.children().show();\r\n\t\t\t\t\tpassword_confirm_notify.find('.msg').html('');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpasswordsmatch = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpassword.on('blur', onPasswordChanged);\r\n\t\tpassword_confirm.on('blur', onPasswordConfirmChanged);\r\n\r\n\t\t$('#changePasswordBtn').on('click', function () {\r\n\t\t\tonPasswordChanged();\r\n\t\t\tonPasswordConfirmChanged();\r\n\r\n\t\t\tvar btn = $(this);\r\n\t\t\tif ((passwordvalid && passwordsmatch) || app.user.isAdmin) {\r\n\t\t\t\tbtn.addClass('disabled').find('i').removeClass('hide');\r\n\t\t\t\tsocket.emit('user.changePassword', {\r\n\t\t\t\t\tcurrentPassword: currentPassword.val(),\r\n\t\t\t\t\tnewPassword: password.val(),\r\n\t\t\t\t\tuid: ajaxify.data.theirid,\r\n\t\t\t\t}, function (err) {\r\n\t\t\t\t\tbtn.removeClass('disabled').find('i').addClass('hide');\r\n\t\t\t\t\tcurrentPassword.val('');\r\n\t\t\t\t\tpassword.val('');\r\n\t\t\t\t\tpassword_confirm.val('');\r\n\t\t\t\t\tpasswordsmatch = false;\r\n\t\t\t\t\tpasswordvalid = false;\r\n\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\tonPasswordChanged();\r\n\t\t\t\t\t\tonPasswordConfirmChanged();\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twindow.location.href = config.relative_path + '/login';\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (!passwordsmatch) {\r\n\t\t\t\t\tapp.alertError('[[user:change_password_error_match]]');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!passwordvalid) {\r\n\t\t\t\t\tapp.alertError('[[user:change_password_error]]');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showError(element, msg) {\r\n\t\ttranslator.translate(msg, function (msg) {\r\n\t\t\telement.html(msg);\r\n\r\n\t\t\telement.parent()\r\n\t\t\t\t.removeClass('show-success')\r\n\t\t\t\t.addClass('show-danger');\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showSuccess(element) {\r\n\t\telement.html('');\r\n\t\telement.parent()\r\n\t\t\t.removeClass('show-danger')\r\n\t\t\t.addClass('show-success');\r\n\t}\r\n\r\n\treturn AccountEditPassword;\r\n});\r\n"]}