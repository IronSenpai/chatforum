{"version":3,"sources":["public/src/client/account/edit.js"],"names":["define","header","translator","components","pictureCropper","AccountEdit","init","$","on","updateProfile","app","loadJQueryUI","datepicker","changeMonth","changeYear","yearRange","defaultDate","handleImageChange","handleAccountDelete","handleEmailConfirm","updateSignature","updateAboutMe","userData","uid","val","fullname","website","birthday","location","groupTitle","signature","aboutme","window","trigger","socket","emit","err","data","alertError","message","alertSuccess","picture","attr","updateHeader","parseInt","ajaxify","theirid","yourid","defaultAvatar","get","pictures","uploaded","reduce","memo","cur","type","templates","parse","icon","text","bgColor","allowProfileImageUploads","html","translate","modal","bootbox","dialog","className","title","show","buttons","close","label","callback","onCloseModal","update","saveSelection","updateImages","selectImageType","find","removeClass","this","addClass","handleImageUpload","parents","each","getAttribute","changeUserPicture","refresh","translated","confirm","user","username","href","config","relative_path","focus","onUploadComplete","urlOnServer","Date","now","length","uploadedpicture","onRemoveComplete","socketMethod","aspectRatio","paramName","paramValue","fileSize","maximumProfileImageSize","allowSkippingCrop","description","accept","url","uploadModal","handleImageCrop","btn","removeAttr","getCharsLeft","el","max","maximumSignatureLength","maximumAboutMeLength"],"mappings":"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","file":"public/src/client/account/edit.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/account/edit', ['forum/account/header', 'translator', 'components', 'pictureCropper'], function (header, translator, components, pictureCropper) {\r\n\tvar AccountEdit = {};\r\n\r\n\tAccountEdit.init = function () {\r\n\t\theader.init();\r\n\r\n\t\t$('#submitBtn').on('click', updateProfile);\r\n\r\n\t\tapp.loadJQueryUI(function () {\r\n\t\t\t$('#inputBirthday').datepicker({\r\n\t\t\t\tchangeMonth: true,\r\n\t\t\t\tchangeYear: true,\r\n\t\t\t\tyearRange: '1900:-5y',\r\n\t\t\t\tdefaultDate: '-13y',\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\thandleImageChange();\r\n\t\thandleAccountDelete();\r\n\t\thandleEmailConfirm();\r\n\t\tupdateSignature();\r\n\t\tupdateAboutMe();\r\n\t};\r\n\r\n\tfunction updateProfile() {\r\n\t\tvar userData = {\r\n\t\t\tuid: $('#inputUID').val(),\r\n\t\t\tfullname: $('#inputFullname').val(),\r\n\t\t\twebsite: $('#inputWebsite').val(),\r\n\t\t\tbirthday: $('#inputBirthday').val(),\r\n\t\t\tlocation: $('#inputLocation').val(),\r\n\t\t\tgroupTitle: $('#groupTitle').val(),\r\n\t\t\tsignature: $('#inputSignature').val(),\r\n\t\t\taboutme: $('#inputAboutMe').val(),\r\n\t\t};\r\n\r\n\t\t$(window).trigger('action:profile.update', userData);\r\n\r\n\t\tsocket.emit('user.updateProfile', userData, function (err, data) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tapp.alertSuccess('[[user:profile_update_success]]');\r\n\r\n\t\t\tif (data.picture) {\r\n\t\t\t\t$('#user-current-picture').attr('src', data.picture);\r\n\t\t\t}\r\n\r\n\t\t\tupdateHeader(data.picture);\r\n\t\t});\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction updateHeader(picture) {\r\n\t\tif (parseInt(ajaxify.data.theirid, 10) !== parseInt(ajaxify.data.yourid, 10)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!picture && ajaxify.data.defaultAvatar) {\r\n\t\t\tpicture = ajaxify.data.defaultAvatar;\r\n\t\t}\r\n\t\tcomponents.get('header/userpicture')[picture ? 'show' : 'hide']();\r\n\t\tcomponents.get('header/usericon')[!picture ? 'show' : 'hide']();\r\n\t\tif (picture) {\r\n\t\t\tcomponents.get('header/userpicture').attr('src', picture);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleImageChange() {\r\n\t\t$('#changePictureBtn').on('click', function () {\r\n\t\t\tsocket.emit('user.getProfilePictures', {\r\n\t\t\t\tuid: ajaxify.data.uid,\r\n\t\t\t}, function (err, pictures) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// boolean to signify whether an uploaded picture is present in the pictures list\r\n\t\t\t\tvar uploaded = pictures.reduce(function (memo, cur) {\r\n\t\t\t\t\treturn memo || cur.type === 'uploaded';\r\n\t\t\t\t}, false);\r\n\r\n\t\t\t\ttemplates.parse('partials/modals/change_picture_modal', {\r\n\t\t\t\t\tpictures: pictures,\r\n\t\t\t\t\tuploaded: uploaded,\r\n\t\t\t\t\ticon: { text: ajaxify.data['icon:text'], bgColor: ajaxify.data['icon:bgColor'] },\r\n\t\t\t\t\tdefaultAvatar: ajaxify.data.defaultAvatar,\r\n\t\t\t\t\tallowProfileImageUploads: ajaxify.data.allowProfileImageUploads,\r\n\t\t\t\t}, function (html) {\r\n\t\t\t\t\ttranslator.translate(html, function (html) {\r\n\t\t\t\t\t\tvar modal = bootbox.dialog({\r\n\t\t\t\t\t\t\tclassName: 'picture-switcher',\r\n\t\t\t\t\t\t\ttitle: '[[user:change_picture]]',\r\n\t\t\t\t\t\t\tmessage: html,\r\n\t\t\t\t\t\t\tshow: true,\r\n\t\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\t\tclose: {\r\n\t\t\t\t\t\t\t\t\tlabel: '[[global:close]]',\r\n\t\t\t\t\t\t\t\t\tcallback: onCloseModal,\r\n\t\t\t\t\t\t\t\t\tclassName: 'btn-link',\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tupdate: {\r\n\t\t\t\t\t\t\t\t\tlabel: '[[global:save_changes]]',\r\n\t\t\t\t\t\t\t\t\tcallback: saveSelection,\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tmodal.on('shown.bs.modal', updateImages);\r\n\t\t\t\t\t\tmodal.on('click', '.list-group-item', function selectImageType() {\r\n\t\t\t\t\t\t\tmodal.find('.list-group-item').removeClass('active');\r\n\t\t\t\t\t\t\t$(this).addClass('active');\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\thandleImageUpload(modal);\r\n\r\n\t\t\t\t\t\tfunction updateImages() {\r\n\t\t\t\t\t\t\t// Check to see which one is the active picture\r\n\t\t\t\t\t\t\tif (!ajaxify.data.picture) {\r\n\t\t\t\t\t\t\t\tmodal.find('.list-group-item .user-icon').parents('.list-group-item').addClass('active');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tmodal.find('.list-group-item img').each(function () {\r\n\t\t\t\t\t\t\t\t\tif (this.getAttribute('src') === ajaxify.data.picture) {\r\n\t\t\t\t\t\t\t\t\t\t$(this).parents('.list-group-item').addClass('active');\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfunction saveSelection() {\r\n\t\t\t\t\t\t\tvar type = modal.find('.list-group-item.active').attr('data-type');\r\n\r\n\t\t\t\t\t\t\tchangeUserPicture(type, function (err) {\r\n\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tupdateHeader(type === 'default' ? '' : modal.find('.list-group-item.active img').attr('src'));\r\n\t\t\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfunction onCloseModal() {\r\n\t\t\t\t\t\t\tmodal.modal('hide');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\treturn false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleAccountDelete() {\r\n\t\t$('#deleteAccountBtn').on('click', function () {\r\n\t\t\ttranslator.translate('[[user:delete_account_confirm]]', function (translated) {\r\n\t\t\t\tvar modal = bootbox.confirm(translated + '<p><input type=\"text\" class=\"form-control\" id=\"confirm-username\" /></p>', function (confirm) {\r\n\t\t\t\t\tif (!confirm) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ($('#confirm-username').val() !== app.user.username) {\r\n\t\t\t\t\t\tapp.alertError('[[error:invalid-username]]');\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsocket.emit('user.deleteAccount', {}, function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\twindow.location.href = config.relative_path + '/';\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tmodal.on('shown.bs.modal', function () {\r\n\t\t\t\t\tmodal.find('input').focus();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleImageUpload(modal) {\r\n\t\tfunction onUploadComplete(urlOnServer) {\r\n\t\t\turlOnServer = config.relative_path + urlOnServer + '?' + Date.now();\r\n\r\n\t\t\tupdateHeader(urlOnServer);\r\n\r\n\t\t\tif (ajaxify.data.picture.length) {\r\n\t\t\t\t$('#user-current-picture, img.avatar').attr('src', urlOnServer);\r\n\t\t\t\tajaxify.data.uploadedpicture = urlOnServer;\r\n\t\t\t} else {\r\n\t\t\t\tajaxify.refresh(function () {\r\n\t\t\t\t\t$('#user-current-picture, img.avatar').attr('src', urlOnServer);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onRemoveComplete() {\r\n\t\t\tif (ajaxify.data.uploadedpicture === ajaxify.data.picture) {\r\n\t\t\t\tajaxify.refresh();\r\n\t\t\t\tupdateHeader();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmodal.find('[data-action=\"upload\"]').on('click', function () {\r\n\t\t\tmodal.modal('hide');\r\n\r\n\t\t\tpictureCropper.show({\r\n\t\t\t\tsocketMethod: 'user.uploadCroppedPicture',\r\n\t\t\t\taspectRatio: 1 / 1,\r\n\t\t\t\tparamName: 'uid',\r\n\t\t\t\tparamValue: ajaxify.data.theirid,\r\n\t\t\t\tfileSize: ajaxify.data.maximumProfileImageSize,\r\n\t\t\t\tallowSkippingCrop: false,\r\n\t\t\t\ttitle: '[[user:upload_picture]]',\r\n\t\t\t\tdescription: '[[user:upload_a_picture]]',\r\n\t\t\t\taccept: '.png,.jpg,.bmp',\r\n\t\t\t}, function (url) {\r\n\t\t\t\tonUploadComplete(url);\r\n\t\t\t});\r\n\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tmodal.find('[data-action=\"upload-url\"]').on('click', function () {\r\n\t\t\tmodal.modal('hide');\r\n\t\t\ttemplates.parse('partials/modals/upload_picture_from_url_modal', {}, function (html) {\r\n\t\t\t\ttranslator.translate(html, function (html) {\r\n\t\t\t\t\tvar uploadModal = $(html);\r\n\t\t\t\t\tuploadModal.modal('show');\r\n\r\n\t\t\t\t\tuploadModal.find('.upload-btn').on('click', function () {\r\n\t\t\t\t\t\tvar url = uploadModal.find('#uploadFromUrl').val();\r\n\t\t\t\t\t\tif (!url) {\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsocket.emit('user.uploadProfileImageFromUrl', {\r\n\t\t\t\t\t\t\tuid: ajaxify.data.uid,\r\n\t\t\t\t\t\t\turl: url,\r\n\t\t\t\t\t\t}, function (err, url) {\r\n\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tuploadModal.modal('hide');\r\n\r\n\t\t\t\t\t\t\tpictureCropper.handleImageCrop({\r\n\t\t\t\t\t\t\t\turl: url,\r\n\t\t\t\t\t\t\t\tsocketMethod: 'user.uploadCroppedPicture',\r\n\t\t\t\t\t\t\t\taspectRatio: '1 / 1',\r\n\t\t\t\t\t\t\t\tallowSkippingCrop: false,\r\n\t\t\t\t\t\t\t\tparamName: 'uid',\r\n\t\t\t\t\t\t\t\tparamValue: ajaxify.data.theirid,\r\n\t\t\t\t\t\t\t}, onUploadComplete);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tmodal.find('[data-action=\"remove-uploaded\"]').on('click', function () {\r\n\t\t\tsocket.emit('user.removeUploadedPicture', {\r\n\t\t\t\tuid: ajaxify.data.theirid,\r\n\t\t\t}, function (err) {\r\n\t\t\t\tmodal.modal('hide');\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tonRemoveComplete();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleEmailConfirm() {\r\n\t\t$('#confirm-email').on('click', function () {\r\n\t\t\tvar btn = $(this).attr('disabled', true);\r\n\t\t\tsocket.emit('user.emailConfirm', {}, function (err) {\r\n\t\t\t\tbtn.removeAttr('disabled');\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tapp.alertSuccess('[[notifications:email-confirm-sent]]');\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction changeUserPicture(type, callback) {\r\n\t\tsocket.emit('user.changePicture', {\r\n\t\t\ttype: type,\r\n\t\t\tuid: ajaxify.data.theirid,\r\n\t\t}, callback);\r\n\t}\r\n\r\n\tfunction getCharsLeft(el, max) {\r\n\t\treturn el.length ? '(' + el.val().length + '/' + max + ')' : '';\r\n\t}\r\n\r\n\tfunction updateSignature() {\r\n\t\tvar el = $('#inputSignature');\r\n\t\t$('#signatureCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumSignatureLength));\r\n\r\n\t\tel.on('keyup change', function () {\r\n\t\t\t$('#signatureCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumSignatureLength));\r\n\t\t});\r\n\t}\r\n\r\n\tfunction updateAboutMe() {\r\n\t\tvar el = $('#inputAboutMe');\r\n\t\t$('#aboutMeCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumAboutMeLength));\r\n\r\n\t\tel.on('keyup change', function () {\r\n\t\t\t$('#aboutMeCharCountLeft').html(getCharsLeft(el, ajaxify.data.maximumAboutMeLength));\r\n\t\t});\r\n\t}\r\n\r\n\r\n\treturn AccountEdit;\r\n});\r\n"]}