{"version":3,"sources":["public/src/admin/manage/group.js"],"names":["define","memberList","iconSelect","colorpicker","translator","Groups","init","groupDetailsSearch","$","groupDetailsSearchResults","groupIcon","changeGroupUserTitle","changeGroupLabelColor","groupLabelPreview","searchDelay","groupName","ajaxify","data","group","name","keyup","text","val","css","on","clearTimeout","setTimeout","searchText","foundUser","socket","emit","query","err","results","users","length","numResults","x","empty","attr","title","username","data-uid","uid","data-username","data-userslug","userslug","data-picture","picture","data-usericon-bgColor","data-usericon-text","append","addClass","html","translateHtml","userLabel","this","parseInt","app","alertError","message","member","icon:bgColor","icon:text","templates","parse","isOwner","members","translate","prepend","btnEl","userRow","parents","ownerFlagEl","find","hasClass","action","toUid","toggleClass","bootbox","confirm","slideUp","remove","enable","hsb","hex","values","userTitle","description","icon","labelColor","userTitleEnabled","is","private","hidden","disableJoinRequests","newName","alertSuccess","go","encodeURIComponent","undefined"],"mappings":"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","file":"public/src/admin/manage/group.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/manage/group', [\r\n\t'forum/groups/memberlist',\r\n\t'iconSelect',\r\n\t'admin/modules/colorpicker',\r\n\t'translator',\r\n], function (memberList, iconSelect, colorpicker, translator) {\r\n\tvar Groups = {};\r\n\r\n\tGroups.init = function () {\r\n\t\tvar\tgroupDetailsSearch = $('#group-details-search');\r\n\t\tvar groupDetailsSearchResults = $('#group-details-search-results');\r\n\t\tvar groupIcon = $('#group-icon');\r\n\t\tvar changeGroupUserTitle = $('#change-group-user-title');\r\n\t\tvar changeGroupLabelColor = $('#change-group-label-color');\r\n\t\tvar groupLabelPreview = $('#group-label-preview');\r\n\t\tvar searchDelay;\r\n\r\n\r\n\t\tvar groupName = ajaxify.data.group.name;\r\n\r\n\t\tmemberList.init('admin/manage/group');\r\n\r\n\t\tchangeGroupUserTitle.keyup(function () {\r\n\t\t\tgroupLabelPreview.text(changeGroupUserTitle.val());\r\n\t\t});\r\n\r\n\t\tchangeGroupLabelColor.keyup(function () {\r\n\t\t\tgroupLabelPreview.css('background', changeGroupLabelColor.val() || '#000000');\r\n\t\t});\r\n\r\n\t\tgroupDetailsSearch.on('keyup', function () {\r\n\t\t\tif (searchDelay) {\r\n\t\t\t\tclearTimeout(searchDelay);\r\n\t\t\t}\r\n\r\n\t\t\tsearchDelay = setTimeout(function () {\r\n\t\t\t\tvar searchText = groupDetailsSearch.val();\r\n\t\t\t\tvar foundUser;\r\n\r\n\t\t\t\tsocket.emit('admin.user.search', {\r\n\t\t\t\t\tquery: searchText,\r\n\t\t\t\t}, function (err, results) {\r\n\t\t\t\t\tif (!err && results && results.users.length > 0) {\r\n\t\t\t\t\t\tvar numResults = results.users.length;\r\n\t\t\t\t\t\tvar x;\r\n\t\t\t\t\t\tif (numResults > 20) {\r\n\t\t\t\t\t\t\tnumResults = 20;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tgroupDetailsSearchResults.empty();\r\n\r\n\t\t\t\t\t\tfor (x = 0; x < numResults; x += 1) {\r\n\t\t\t\t\t\t\tfoundUser = $('<li />');\r\n\t\t\t\t\t\t\tfoundUser\r\n\t\t\t\t\t\t\t\t.attr({\r\n\t\t\t\t\t\t\t\t\ttitle: results.users[x].username,\r\n\t\t\t\t\t\t\t\t\t'data-uid': results.users[x].uid,\r\n\t\t\t\t\t\t\t\t\t'data-username': results.users[x].username,\r\n\t\t\t\t\t\t\t\t\t'data-userslug': results.users[x].userslug,\r\n\t\t\t\t\t\t\t\t\t'data-picture': results.users[x].picture,\r\n\t\t\t\t\t\t\t\t\t'data-usericon-bgColor': results.users[x]['icon:bgColor'],\r\n\t\t\t\t\t\t\t\t\t'data-usericon-text': results.users[x]['icon:text'],\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.append(results.users[x].picture ?\r\n\t\t\t\t\t\t\t\t\t$('<img />').addClass('avatar avatar-sm').attr('src', results.users[x].picture) :\r\n\t\t\t\t\t\t\t\t\t$('<div />').addClass('avatar avatar-sm').css('background-color', results.users[x]['icon:bgColor']).html(results.users[x]['icon:text']))\r\n\t\t\t\t\t\t\t\t.append($('<span />').html(results.users[x].username));\r\n\r\n\t\t\t\t\t\t\tgroupDetailsSearchResults.append(foundUser);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tgroupDetailsSearchResults.translateHtml('<li>[[admin/manage/groups:edit.no-users-found]]</li>');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}, 200);\r\n\t\t});\r\n\r\n\t\tgroupDetailsSearchResults.on('click', 'li[data-uid]', function () {\r\n\t\t\tvar userLabel = $(this);\r\n\t\t\tvar uid = parseInt(userLabel.attr('data-uid'), 10);\r\n\r\n\t\t\tsocket.emit('admin.groups.join', {\r\n\t\t\t\tgroupName: groupName,\r\n\t\t\t\tuid: uid,\r\n\t\t\t}, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar member = {\r\n\t\t\t\t\tuid: userLabel.attr('data-uid'),\r\n\t\t\t\t\tusername: userLabel.attr('data-username'),\r\n\t\t\t\t\tuserslug: userLabel.attr('data-userslug'),\r\n\t\t\t\t\tpicture: userLabel.attr('data-picture'),\r\n\t\t\t\t\t'icon:bgColor': userLabel.attr('data-usericon-bgColor'),\r\n\t\t\t\t\t'icon:text': userLabel.attr('data-usericon-text'),\r\n\t\t\t\t};\r\n\r\n\t\t\t\ttemplates.parse('admin/partials/groups/memberlist', 'members', {\r\n\t\t\t\t\tgroup: {\r\n\t\t\t\t\t\tisOwner: ajaxify.data.group.isOwner,\r\n\t\t\t\t\t\tmembers: [member],\r\n\t\t\t\t\t},\r\n\t\t\t\t}, function (html) {\r\n\t\t\t\t\ttranslator.translate(html, function (html) {\r\n\t\t\t\t\t\t$('[component=\"groups/members\"] tbody').prepend(html);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('[component=\"groups/members\"]').on('click', '[data-action]', function () {\r\n\t\t\tvar btnEl = $(this);\r\n\t\t\tvar userRow = btnEl.parents('[data-uid]');\r\n\t\t\tvar ownerFlagEl = userRow.find('.member-name i');\r\n\t\t\tvar isOwner = !ownerFlagEl.hasClass('invisible');\r\n\t\t\tvar uid = userRow.attr('data-uid');\r\n\t\t\tvar action = btnEl.attr('data-action');\r\n\r\n\t\t\tswitch (action) {\r\n\t\t\tcase 'toggleOwnership':\r\n\t\t\t\tsocket.emit('groups.' + (isOwner ? 'rescind' : 'grant'), {\r\n\t\t\t\t\ttoUid: uid,\r\n\t\t\t\t\tgroupName: groupName,\r\n\t\t\t\t}, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\townerFlagEl.toggleClass('invisible');\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'kick':\r\n\t\t\t\tbootbox.confirm('[[admin/manage/groups:edit.confirm-remove-user]]', function (confirm) {\r\n\t\t\t\t\tif (!confirm) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsocket.emit('admin.groups.leave', {\r\n\t\t\t\t\t\tuid: uid,\r\n\t\t\t\t\t\tgroupName: groupName,\r\n\t\t\t\t\t}, function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tuserRow.slideUp().remove();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#group-icon').on('click', function () {\r\n\t\t\ticonSelect.init(groupIcon);\r\n\t\t});\r\n\r\n\t\tcolorpicker.enable(changeGroupLabelColor, function (hsb, hex) {\r\n\t\t\tgroupLabelPreview.css('background-color', '#' + hex);\r\n\t\t});\r\n\r\n\t\t$('#save').on('click', function () {\r\n\t\t\tsocket.emit('admin.groups.update', {\r\n\t\t\t\tgroupName: groupName,\r\n\t\t\t\tvalues: {\r\n\t\t\t\t\tname: $('#change-group-name').val(),\r\n\t\t\t\t\tuserTitle: changeGroupUserTitle.val(),\r\n\t\t\t\t\tdescription: $('#change-group-desc').val(),\r\n\t\t\t\t\ticon: groupIcon.attr('value'),\r\n\t\t\t\t\tlabelColor: changeGroupLabelColor.val(),\r\n\t\t\t\t\tuserTitleEnabled: $('#group-userTitleEnabled').is(':checked'),\r\n\t\t\t\t\tprivate: $('#group-private').is(':checked'),\r\n\t\t\t\t\thidden: $('#group-hidden').is(':checked'),\r\n\t\t\t\t\tdisableJoinRequests: $('#group-disableJoinRequests').is(':checked'),\r\n\t\t\t\t},\r\n\t\t\t}, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar newName = $('#change-group-name').val();\r\n\r\n\t\t\t\t// If the group name changed, change url\r\n\t\t\t\tif (groupName === newName) {\r\n\t\t\t\t\tapp.alertSuccess('[[admin/manage/groups:edit.save-success]]');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tajaxify.go('admin/manage/groups/' + encodeURIComponent(newName), undefined, true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t});\r\n\t};\r\n\r\n\treturn Groups;\r\n});\r\n"]}